---
- name: restart journald
  become: true
  ansible.builtin.service:
    name: systemd-journald
    state: restarted

- name: restart_sshd
  become: true
  ansible.builtin.service:
    name: sshd
    state: restarted
    enabled: true

- name: restart docker
  become: true
  ansible.builtin.service:
    name: docker
    state: restarted

- name: restart_ntp
  become: true
  ansible.builtin.service:
    name: "{{ ntp_service }}"
    state: restarted
    enabled: true
  when:
    - lookup('env', 'CI') != 'true'
    - ansible_virtualization_type != "docker"

- name: systemd-vconsole-setup
  become: true
  ansible.builtin.service:
    name: systemd-vconsole-setup.service
    state: restarted
  when:
    - lookup('env', 'CI') != 'true'
    - ansible_service_mgr == "systemd"
    - ansible_virtualization_type != "docker"

- name: sshd_agent_user
  ansible.builtin.systemd:
    scope: user
    name: ssh-agent.service
    state: restarted
    enabled: true
    daemon_reload: true
